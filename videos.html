<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Glazo ‚Äî Toutes les vid√©os</title>
    <meta name="description" content="Toutes les vid√©os de Glazo">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              display: ['Sora', 'ui-sans-serif', 'system-ui'],
              sans: ['Poppins', 'ui-sans-serif', 'system-ui']
            },
            colors: { brand: { start: '#7C3AED', end: '#EC4899' } },
            boxShadow: { glow: '0 0 0 2px rgba(124,58,237,0.25), 0 10px 30px rgba(236,72,153,0.25)' }
          }
        }
      }
    </script>
    <style>
      :root{
        --bg: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,.25), transparent 60%),
              radial-gradient(1000px 500px at 90% 20%, rgba(236,72,153,.25), transparent 60%),
              linear-gradient(135deg, #0b0b12 0%, #0e0b17 100%);
        --text:#ffffff; --text-80:rgba(255,255,255,0.8); --text-70:rgba(255,255,255,0.7); --text-60:rgba(255,255,255,0.6); --text-50:rgba(255,255,255,0.5);
        --card: rgba(255,255,255,0.06);
        --border: rgba(255,255,255,0.08);
      }
      .theme-light{
        /* Th√®me clair Teal/Cyan sans blanc - fond aurora plus color√© */
        --bg:
          conic-gradient(from 220deg at 18% 12%, rgba(6,182,212,.24), transparent 38%),
          conic-gradient(from 120deg at 86% 22%, rgba(45,212,191,.22), transparent 42%),
          radial-gradient(1000px 520px at 18% 78%, rgba(56,189,248,.20), transparent 60%),
          radial-gradient(900px 480px at 82% 86%, rgba(34,211,238,.18), transparent 62%),
          linear-gradient(135deg, #c6f7fb 0%, #b7f4ee 52%, #b8f7ff 100%);
        --text:#0a0f10; --text-80:rgba(10,15,16,0.92); --text-70:rgba(10,15,16,0.86); --text-60:rgba(10,15,16,0.78); --text-50:rgba(10,15,16,0.68);
        --card: rgba(6,182,212,0.16);
        --border: rgba(6,182,212,0.30);
      }
      .gradient-bg { background: var(--bg); }
      .animated-gradient { background: linear-gradient(120deg, var(--g1), var(--g2), var(--g1)); background-size: 200% 200%; animation: shift 12s ease-in-out infinite; }
      @keyframes shift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
      .glass { background: var(--card); -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px); border: 1px solid var(--border); }
      .theme-light .text-white{ color: var(--text) !important; }
      .theme-light .text-white\/80{ color: var(--text-80) !important; }
      .theme-light .text-white\/70{ color: var(--text-70) !important; }
      .theme-light .text-white\/60{ color: var(--text-60) !important; }
      .theme-light .text-white\/50{ color: var(--text-50) !important; }
      /* Hover plus visible en clair */
      .theme-light .hover\:text-white:hover{ color:#06B6D4 !important; }
      /* Boutons blancs -> primaires cyan en clair */
      .theme-light .bg-white{ background-color:#06B6D4 !important; color:#0a0f10 !important; }
      .theme-light .hover\:bg-white\/90:hover{ background-color:#0891B2 !important; color:#0a0f10 !important; }
      /* Forcer une couleur par d√©faut lisible pour tout le texte en clair */
      .theme-light{ color: var(--text); }
      .theme-light *{ color: inherit; }
      /* === Mode sombre: harmoniser boutons avec la palette brand (violet/rose) === */
      body:not(.theme-light) .bg-white\/10{ background-color: rgba(124,58,237,0.22) !important; color:#ffffff !important; }
      body:not(.theme-light) .hover\:bg-white\/20:hover{ background-color: rgba(236,72,153,0.30) !important; color:#ffffff !important; }
      body:not(.theme-light) .bg-white{ background-color:#7C3AED !important; color:#ffffff !important; }
      body:not(.theme-light) .hover\:bg-white\/90:hover{ background-color:#6D28D9 !important; color:#ffffff !important; }
      /* Titres/CTA demand√©s en noir en mode clair */
      .theme-light [data-i18n="home.portfolio.title"],
      .theme-light [data-i18n="portfolio.title"],
      .theme-light [data-i18n="services.title"],
      .theme-light [data-i18n="portfolio.shorts"],
      .theme-light [data-i18n="portfolio.shortsTitle"],
      .theme-light [data-i18n="portfolio.long"],
      .theme-light [data-i18n="portfolio.longs"],
      .theme-light [data-i18n="portfolio.longTitle"],
      .theme-light [data-i18n="portfolio.jingle"],
      .theme-light [data-i18n="portfolio.jingleTitle"],
      .theme-light [data-i18n="cta.viewPortfolio"]{
        color:#0a0a12 !important;
      }
      /* Rendre le menu Compte plus lisible (fond plus opaque) */
      /* Dropdown compte: plus joli et lisible */
      .account-panel{ background-color: rgba(0,0,0,0.72) !important; border:1px solid rgba(255,255,255,0.12); box-shadow: 0 20px 50px rgba(0,0,0,0.35); }
      .account-panel a, .account-panel button, .account-panel div{ color: rgba(255,255,255,0.92); }
      .account-panel a, .account-panel button{ border-radius: 10px; }
      .account-panel a:hover, .account-panel button:hover{ background-color: rgba(255,255,255,0.14) !important; }
      .theme-light .account-panel{ background-color: rgba(255,255,255,0.92) !important; border:1px solid rgba(0,0,0,0.08); box-shadow: 0 20px 50px rgba(0,0,0,0.12); }
      .theme-light .account-panel a, .theme-light .account-panel button, .theme-light .account-panel div{ color:#0a0f10 !important; }
      .theme-light .account-panel a:hover, .theme-light .account-panel button:hover{ background-color: rgba(6,182,212,0.16) !important; }
    </style>
  </head>
  <body class="gradient-bg text-white min-h-screen">
    <header class="sticky top-0 z-50">
      <div class="max-w-6xl mx-auto px-4">
        <nav class="glass mt-4 rounded-2xl px-4 py-3 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl animated-gradient" style="--g1:#7C3AED; --g2:#EC4899;"></div>
            <span class="font-display text-lg tracking-wide">Glazo</span>
          </div>
          <div class="hidden md:flex items-center gap-6 text-sm text-white/80">
            <a href="index.html" class="hover:text-white">Home</a>
            <a href="index.html#services" class="hover:text-white">Services</a>
            <a href="index.html#portfolio" class="hover:text-white">Portfolio</a>
            <a href="videos.html" class="hover:text-white">Vid√©os</a>
            <a href="reviews.html" class="hover:text-white">Avis</a>
            <a href="index.html#contact" class="hover:text-white">Contact</a>
            <select id="lang" class="ml-2 bg-white text-black rounded-xl px-3 py-2 outline-none">
              <option value="fr">FR</option>
              <option value="en">EN</option>
              <option value="es">ES</option>
              <option value="de">DE</option>
              <option value="it">IT</option>
              <option value="zh-Hant">ÁπÅÈ´î</option>
            </select>
            <div class="relative flex items-center gap-2">
              <a id="account-btn" href="login.html" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition shadow-glow">Compte / Se connecter</a>
              <div id="account-menu" class="hidden absolute right-0 top-full mt-2 w-64 glass account-panel rounded-xl p-3 text-sm origin-top-right transition duration-200 ease-out opacity-0 scale-95 translate-y-2 pointer-events-none z-50 max-h-80 overflow-y-auto">
                <div class="mb-2">
                  <div id="account-name" class="font-semibold">Utilisateur</div>
                  <div id="account-email" class="text-white/70 truncate">‚Äî</div>
                </div>
                <a href="settings.html" class="block px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20">Param√®tres</a>
                <a href="reviews.html" class="mt-1 block px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20">Mes avis</a>
                <button id="logout" class="mt-2 w-full text-left px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20">Se d√©connecter</button>
              </div>
              <button id="theme-toggle" aria-label="Theme" class="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-white/10 hover:bg-white/20 transition">üåô</button>
            </div>
          </div>
          <!-- Mobile controls -->
          <div class="md:hidden flex items-center gap-2">
            <button id="theme-toggle-m" aria-label="Theme" class="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-white/10 hover:bg-white/20 transition">üåô</button>
            <button id="menu-toggle" aria-label="Menu" class="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-white/10 hover:bg-white/20">‚ò∞</button>
          </div>
        </nav>
        <!-- Mobile menu panel -->
        <div id="mobile-menu" class="md:hidden hidden glass mt-2 rounded-2xl p-4">
          <div class="flex flex-col gap-3 text-sm">
            <a href="index.html" class="hover:text-white">Home</a>
            <a href="index.html#services" class="hover:text-white">Services</a>
            <a href="index.html#portfolio" class="hover:text-white">Portfolio</a>
            <a href="videos.html" class="hover:text-white">Vid√©os</a>
            <a href="reviews.html" class="hover:text-white">Avis</a>
            <a href="index.html#contact" class="hover:text-white">Contact</a>
            <hr class="border-white/10">
            <a id="account-btn-m" href="login.html" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition">Compte / Se connecter</a>
            <div class="flex items-center gap-2">
              <label class="text-white/70 text-xs">Lang</label>
              <select id="lang-m" class="bg-white text-black rounded-xl px-3 py-2 outline-none">
                <option value="fr">FR</option>
                <option value="en">EN</option>
                <option value="es">ES</option>
                <option value="de">DE</option>
                <option value="it">IT</option>
                <option value="zh-Hant">ÁπÅÈ´î</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="max-w-6xl mx-auto px-4 py-10 md:py-14">
        <h1 id="title-all-videos" class="font-display text-3xl md:text-4xl mb-2">Toutes les vid√©os</h1>

        <div id="videos-grid" class="grid sm:grid-cols-2 md:grid-cols-3 gap-6"></div>


      </section>
    </main>

    <footer class="py-10 text-center text-xs text-white/50">¬© <span id="y"></span> Glazo. Tous droits r√©serv√©s.</footer>
    <script>document.getElementById('y').textContent = new Date().getFullYear();</script>
  
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
      import { initializeFirestore, getDoc, setDoc, doc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
      import { I18N } from "./assets/i18n.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAbx4ixAtYFaIGsc69IChLyB0huNt1K5K4",
        authDomain: "site-glazo.firebaseapp.com",
        projectId: "site-glazo",
        storageBucket: "site-glazo.firebasestorage.app",
        messagingSenderId: "13557132291",
        appId: "1:13557132291:web:80c0f3219b06100b03b236",
        measurementId: "G-DVFXY4ZJBT"
      };
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = initializeFirestore(app, { experimentalForceLongPolling: true, useFetchStreams: false });

      const accountBtn = document.getElementById('account-btn');
      const accountMenu = document.getElementById('account-menu');
      const accountEmail = document.getElementById('account-email');
      const logoutBtn = document.getElementById('logout');
      // Affichage du pseudo depuis Firestore
      let currentDisplayName = '';
      async function loadUserProfile(user){
        currentDisplayName = '';
        if (!user) return;
        try{
          const snap = await getDoc(doc(db, 'users', user.uid));
          if (snap.exists()){
            const data = snap.data();
            currentDisplayName = (data && data.displayName) ? String(data.displayName) : '';
          }
          // mettre √† jour le libell√© du bouton une fois le profil charg√©
          if (accountBtn) accountBtn.textContent = currentDisplayName || 'Mon compte';
          if (accountBtnM) accountBtnM.textContent = currentDisplayName || 'Mon compte';
        }catch(e){ /* ignore */ }
      }

      // ===== Admin helpers (badge + lien) =====
      function showAdminBadge(){
        if (!document.title.startsWith('[ADMIN] ')) document.title = '[ADMIN] ' + document.title;
        if (document.getElementById('admin-badge')) return;
        const b = document.createElement('div');
        b.id = 'admin-badge'; b.textContent = 'ADMIN';
        Object.assign(b.style, { position:'fixed', top:'12px', right:'12px', zIndex:'9999', padding:'6px 10px', borderRadius:'12px', background:'linear-gradient(135deg, rgba(124,58,237,.9), rgba(236,72,153,.9))', boxShadow:'0 8px 24px rgba(0,0,0,.25)', fontSize:'12px', letterSpacing:'0.08em', fontWeight:'700', userSelect:'none' });
        document.body.appendChild(b);
      }
      async function ensureAdminLink(user){
        try{
          const snap = await getDoc(doc(db, 'users', user.uid));
          const isAdmin = snap.exists() && snap.data() && snap.data().role === 'admin';
          if (!isAdmin) return;
          showAdminBadge();
          let link = document.getElementById('admin-link');
          if (!link){
            if (!accountMenu) return;
            link = document.createElement('a');
            link.id = 'admin-link'; link.href = 'admin.html';
            link.className = 'mt-1 block px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20';
            link.textContent = 'Admin';
            const logoutRef = document.getElementById('logout');
            if (logoutRef && logoutRef.parentElement === accountMenu){ accountMenu.insertBefore(link, logoutRef); }
            else accountMenu.appendChild(link);
          }
        }catch(_){}
      }

      // Dropdown anim√© comme l'accueil
      function openAccountMenu(){
        if (!accountMenu) return;
        accountMenu.classList.remove('hidden');
        requestAnimationFrame(()=>{
          accountMenu.classList.remove('opacity-0','scale-95','translate-y-2','pointer-events-none');
          accountMenu.classList.add('opacity-100','scale-100','translate-y-0');
        });

      // ===== Rendu des vid√©os depuis Firestore =====
      const grid = document.getElementById('videos-grid');
      function getYouTubeId(url){
        try{
          const u = new URL(url);
          if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
          if (u.searchParams.get('v')) return u.searchParams.get('v');
          if (u.hostname.includes('youtube.com') && u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
        }catch(_){}
        return '';
      }
      function videoCard(v){
        const wrap = document.createElement('div');
        wrap.className = 'glass rounded-2xl overflow-hidden';
        const plat = (v.platform||'').toLowerCase();
        if (plat === 'youtube'){
          const id = getYouTubeId(v.url||'');
          const embed = id ? `https://www.youtube-nocookie.com/embed/${id}` : '';
          wrap.innerHTML = `
            <div class="aspect-[16/9] w-full">${embed ? `<iframe class="w-full h-full" loading="lazy" src="${embed}" title="YouTube" frameborder="0" referrerpolicy="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>` : ''}</div>
            <a href="${v.url}" target="_blank" rel="noopener" class="block text-xs text-white/60 hover:text-white px-3 py-2">Ouvrir sur YouTube ‚Üó</a>
          `;
        } else {
          // Cartes simples pour TikTok / Instagram (lien externe)
          const label = plat === 'tiktok' ? 'TikTok' : (plat === 'instagram' ? 'Instagram' : 'Vid√©o');
          wrap.innerHTML = `
            <div class="aspect-[16/9] w-full flex items-center justify-center text-white/60">${label}</div>
            <a href="${v.url}" target="_blank" rel="noopener" class="block text-xs text-white/60 hover:text-white px-3 py-2">Ouvrir sur ${label} ‚Üó</a>
          `;
        }
        return wrap;
      }
      async function loadVideos(){
        if (!grid) return;
        grid.innerHTML = '';
        try{
          const snap = await getDocs(collection(db, 'videos'));
          if (snap.empty){ grid.innerHTML = '<div class="text-white/60">Aucune vid√©o.</div>'; return; }
          snap.forEach(d=>{ const v = d.data(); grid.appendChild(videoCard(v)); });
        }catch(e){ grid.innerHTML = '<div class="text-red-400">Impossible de charger les vid√©os.</div>'; }
      }

      // Charger les vid√©os au chargement
      loadVideos();
      }
      function closeAccountMenu(){
        if (!accountMenu) return;
        accountMenu.classList.add('opacity-0','scale-95','translate-y-2','pointer-events-none');
        accountMenu.classList.remove('opacity-100','scale-100','translate-y-0');
        const onEnd = (e)=>{
          if (e.propertyName !== 'opacity') return;
          accountMenu.classList.add('hidden');
          accountMenu.removeEventListener('transitionend', onEnd);
        };
        accountMenu.addEventListener('transitionend', onEnd);
      }
      const langSel = document.getElementById('lang');
      const themeBtn = document.getElementById('theme-toggle');
      const themeBtnM = document.getElementById('theme-toggle-m');
      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const accountBtnM = document.getElementById('account-btn-m');
      const langSelM = document.getElementById('lang-m');

      // THEME: apply saved theme
      const savedTheme = localStorage.getItem('theme') || 'dark';
      if (savedTheme === 'light') {
        document.body.classList.add('theme-light');
        if (themeBtn) themeBtn.textContent = '‚òÄÔ∏è';
        if (themeBtnM) themeBtnM.textContent = '‚òÄÔ∏è';
      } else {
        if (themeBtn) themeBtn.textContent = 'üåô';
        if (themeBtnM) themeBtnM.textContent = 'üåô';
      }
      if (themeBtn) {
        themeBtn.addEventListener('click', ()=>{
          const isLight = document.body.classList.toggle('theme-light');
          localStorage.setItem('theme', isLight ? 'light' : 'dark');
          themeBtn.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
          if (themeBtnM) themeBtnM.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
        });
      }
      if (themeBtnM) {
        themeBtnM.addEventListener('click', ()=>{
          const isLight = document.body.classList.toggle('theme-light');
          localStorage.setItem('theme', isLight ? 'light' : 'dark');
          themeBtnM.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
          if (themeBtn) themeBtn.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
        });
      }
      if (menuToggle && mobileMenu) {
        menuToggle.addEventListener('click', ()=>{
          mobileMenu.classList.toggle('hidden');
        });
      }

      I18N.init(langSel, 'videos');
      if (langSel && langSelM) {
        langSelM.value = I18N.getCurrentLang ? I18N.getCurrentLang() : (localStorage.getItem('lang') || 'fr');
        langSelM.addEventListener('change', ()=>{ I18N.setLang(langSelM.value); langSel.value = langSelM.value; });
        langSel.addEventListener('change', ()=>{ langSelM.value = langSel.value; });
      }

      onAuthStateChanged(auth, (user)=>{
        I18N.setAuthState(user);
        if (user) {
          if (accountBtn) {
            accountBtn.href = '#';
            accountBtn.classList.remove('w-10','h-10','justify-center');
            accountBtn.textContent = (typeof currentDisplayName!== 'undefined' && currentDisplayName) ? currentDisplayName : 'Mon compte';
          }
          if (accountEmail) accountEmail.textContent = user.email || '‚Äî';
          if (accountBtn)    accountBtn.onclick = (e)=>{ e.preventDefault(); const n = document.getElementById('account-name'); if (n) n.textContent = (typeof currentDisplayName!== 'undefined' && currentDisplayName) ? currentDisplayName : 'Utilisateur'; if (accountMenu.classList.contains('hidden')) openAccountMenu(); else closeAccountMenu(); };
          if (accountBtnM) {
            accountBtnM.href = '#';
            accountBtnM.classList.remove('w-10','h-10','justify-center');
            accountBtnM.textContent = (typeof currentDisplayName!== 'undefined' && currentDisplayName) ? currentDisplayName : 'Mon compte';
          }
          loadUserProfile(user);
          ensureAdminLink(user);
        } else {
          if (accountBtn) { accountBtn.href = 'login.html'; accountBtn.textContent = 'Compte / Se connecter'; }
          if (accountMenu) closeAccountMenu();
          if (accountBtnM) { accountBtnM.href = 'login.html'; accountBtnM.textContent = 'Compte / Se connecter'; }
          currentDisplayName = '';
        }
      });

      if (logoutBtn) {
        logoutBtn.addEventListener('click', async ()=>{
          await signOut(auth);
          accountMenu.classList.add('hidden');
          window.location.href = 'index.html';
        });
      }

      document.addEventListener('click', (e)=>{
        if (!accountMenu) return;
        const open = !accountMenu.classList.contains('hidden');
        if (!open) return;
        const within = accountMenu.contains(e.target) || accountBtn.contains(e.target);
        if (!within) closeAccountMenu();
      });
      if (mobileMenu) {
        mobileMenu.addEventListener('click', (e)=>{
          const t = e.target;
          if (t.tagName === 'A') mobileMenu.classList.add('hidden');
        });
      }
    </script>
  </body>
</html>
